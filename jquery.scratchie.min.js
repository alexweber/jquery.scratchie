/**
 * Scratchie Plugin
 *
 * @version 1.1 (31/05/2010)
 * @requires jQuery v1.3.2
 * @author Alex Weber <alexweber.com.br>
 * @copyright Copyright (c) 2010, Alex Weber
 * @license http://www.opensource.org/licenses/bsd-license.php
 * @see http://www.alexweber.com.br/jquery/scratchie
 *
 * Distributed under the terms of the new BSD License
 */
(function(a){a.fn.scratchie=function(f){var h={cursor:"coin.gif",cursorHeight:20,cursorWidth:20,target:"target",img:"prize.jpg",title:"Are you feeling lucky today?",fillColor:"#cc0000",fillImg:"overlay.jpg",fillX:20,fillY:20,completion:60,uncoverOnComplete:true,requireMouseClick:true,callback:function(){alert("Congratulations!")}};if(f){if(typeof f=="object"){a.extend(h,f)}else{h.target=f}}var e=false;var b=overlaysUncovered=0;var k=function(){a().one("mouseup",function(){e=false;a().unbind();a(".scratch_overlay").bind("mousedown",k)});return false};var d=function(l){a("#cursor").css({left:l.clientX-2,top:l.clientY+1})};var c=function(){a("#cursor").show();return false};var g=function(){a("#cursor").hide();return false};this.each(function(){var p,r,l,q,s,o,n,m;p=a(this);r=a("#"+h.target);p.css({cursor:"url(blank.cur), none",visibility:"none"});r.attr({src:h.img,alt:h.title,title:h.title,zIndex:1}).bind("mousedown",function(){return false});q=r.height();l=r.width();s=r.position();tt=s.top;tl=s.left;n=m=0;p.after('<div id="cursor" style="cursor:none;width:'+h.cursorWidth+"px;height:"+h.cursorHeight+"px;position:absolute;display:none;top:0;left:0;z-index:10000;background:url("+h.cursor+') top  left no-repeat;"></div>');o="";for(i=0;i<l;i+=h.fillX){for(j=0;j<q;j+=h.fillY){++b;o+='<div class="scratch_overlay" style="z-index:100;height:'+h.fillY+"px;width:"+h.fillX+"px;	position:absolute;border:0;overflow:hidden;top:"+(tt+j)+"px;left:"+(tl+i)+"px;background:";if(h.fillImg){o+=" transparent url("+h.fillImg+") -"+n+"px -"+m+"px no-repeat;";m+=h.fillY}else{o+=h.fillColor}o+='"/>'}if(h.fillImg){m=0;n+=h.fillX}}p.after(o);a(".scratch_overlay").css("cursor","url(blank.cur), none");r.bind("mouseout",function(){g()}).bind("mouseenter",function(){c()}).bind("mousemove",function(t){d(t)});a(".scratch_overlay").bind("mouseout",function(){g()}).bind("mouseenter",function(){c()}).bind("mousemove",function(t){d(t)});if(h.requireMouseClick===true){a(".scratch_overlay").bind("mousedown",function(){e=true;k();a(this).remove();return false})}a(".scratch_overlay").bind("mouseover",function(){if(e===true||h.requireMouseClick===false){++overlaysUncovered;a(this).remove();if((overlaysUncovered/b)*100>=h.completion){if(h.uncoverOnComplete===true){a(".scratch_overlay").remove()}h.callback()}}})});return this}})(jQuery);
